generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]
  houseId       Int?
  alertsCreated Alert[]
  bills         Bill[]
  housesCreated House[]   @relation("HouseCreator")
  shares        Share[]
  house         House?    @relation("HouseMembers", fields: [houseId], references: [id])
  tasks         Task[]    @relation("TaskAssignees")
  activities    Activity[]
  rooms         Room[]    @relation("RoomUsers")

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model House {
  id          Int         @id @default(autoincrement())
  name        String
  address     String?
  imageUrl    String?   
  createdById String
  inviteCode  String      @unique @default(uuid())
  alerts      Alert[]
  bills       Bill[]
  createdBy   User        @relation("HouseCreator", fields: [createdById], references: [id])
  infos       HouseInfo[]
  tasks Task[]

  activities Activity[]

  rooms       Room[]
  users       User[]      @relation("HouseMembers")
  credentials HouseCredential[]
}

model Room {
  id        Int      @id @default(autoincrement())
  name      String
  houseId   Int
  house     House    @relation(fields: [houseId], references: [id])
  roomType  RoomType
  isCommon  Boolean  @default(false)
  tasks     Task[]
  users     User[]   @relation("RoomUsers")
  
}

model Task {
  id          Int     @id @default(autoincrement())
  title       String
  description String?
  status      Boolean @default(false)

  houseId Int
  house   House @relation(fields: [houseId], references: [id])

  roomId Int?
  room   Room?  @relation(fields: [roomId], references: [id])

  assigned User[] @relation("TaskAssignees")
}

model Bill {
  id            Int      @id @default(autoincrement())
  title         String
  description   String?
  totalValue    Float
  dueDate       DateTime
  houseId       Int
  responsibleId String
  house         House    @relation(fields: [houseId], references: [id])
  responsible   User     @relation(fields: [responsibleId], references: [id])
  shares        Share[]
}

model Share {
  id     Int     @id @default(autoincrement())
  billId Int
  userId String
  value  Float
  paid   Boolean @default(false)
  bill   Bill    @relation(fields: [billId], references: [id])
  user   User    @relation(fields: [userId], references: [id])
}

model HouseInfo {
  id      Int    @id @default(autoincrement())
  houseId Int
  key     String
  value   String
  house   House  @relation(fields: [houseId], references: [id])
}

model HouseCredential {
  id        Int            @id @default(autoincrement())
  houseId   Int
  type      CredentialType
  label     String
  email     String?
  username  String?
  password  String?
  url       String?
  notes     String?
  createdAt DateTime       @default(now())

  house     House          @relation(fields: [houseId], references: [id])
}

model Alert {
  id          String    @id @default(uuid())
  title       String
  message     String
  priority    Priority  @default(MEDIUM)
  createdAt   DateTime  @default(now())
  expiresAt   DateTime?
  isResolved  Boolean   @default(false)
  createdById String
  houseId     Int
  createdBy   User      @relation(fields: [createdById], references: [id])
  house       House     @relation(fields: [houseId], references: [id])
}

model Activity {
  id        Int            @id @default(autoincrement())
  houseId   Int
  userId    String?
  type      ActivityType
  entity    ActivityEntity
  entityId  Int?
  title     String
  message   String
  createdAt DateTime       @default(now())

  house House @relation(fields: [houseId], references: [id])
  user  User? @relation(fields: [userId], references: [id])

  @@index([houseId, createdAt])
}

enum ActivityType {
  CREATE
  UPDATE
  DELETE
  COMPLETE
  PAY
  RESOLVE
}

enum ActivityEntity {
  HOUSE
  ROOM
  TASK
  BILL
  SHARE
  ALERT
  CREDENTIAL
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum CredentialType {
  WIFI
  APPLIANCE
  SERVICE
  OTHER
}

enum RoomType {
  LIVING_ROOM
  KITCHEN
  BATHROOM
  BEDROOM
  EXTERNAL
  OTHER
}
